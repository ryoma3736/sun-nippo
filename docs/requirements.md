# 要件定義書 - サントリー営業担当者向け日報アプリ

**プロジェクト名**: sun-nippo
**バージョン**: 1.0.0
**作成日**: 2025-12-07
**ステータス**: Draft

---

## 📋 1. プロジェクト概要

### 1.1 背景と目的

サントリーの営業担当者（ラインダー）が日々の営業活動を効率的に記録・報告するためのWebアプリケーションを開発する。

#### 主な目的

- **営業活動の効率化**: 日報作成時間を50%削減
- **データの可視化**: 訪問実績・売上データのリアルタイム把握
- **意思決定の支援**: データに基づく営業戦略の立案
- **管理業務の簡素化**: マネージャーの承認業務を効率化

### 1.2 スコープ

#### 対象範囲（In Scope）

- 訪問記録の登録・管理
- 売上・受注情報の記録
- 日報の自動生成・提出
- マスタデータ管理（店舗・商品）
- ユーザー認証・権限管理
- 基本的なレポート機能

#### 対象外（Out of Scope - Phase 2以降）

- 高度な分析・BI機能
- モバイルアプリ（ネイティブ）
- 他システムとのAPI連携
- AIによる自動推薦機能

---

## 👥 2. ユーザー定義

### 2.1 ユーザーロール

| ロール | 説明 | 主な機能 |
|--------|------|----------|
| **SALES（営業担当）** | 営業活動を行うラインダー | 訪問記録、受注入力、日報作成 |
| **MANAGER（マネージャー）** | 営業チームの管理者 | 日報承認、チーム実績確認、分析 |
| **ADMIN（管理者）** | システム管理者 | ユーザー管理、マスタデータ管理 |

### 2.2 ペルソナ

#### ペルソナ1: 営業担当者（田中さん）

- **年齢**: 28歳
- **経験**: 営業3年目
- **課題**:
  - 日報作成に毎日30分以上かかる
  - 過去の訪問履歴を探すのが面倒
  - 手書きメモからの転記が非効率
- **期待**:
  - スマホでサクッと入力できる
  - 自動で日報がまとまる
  - 過去の訪問履歴がすぐ見られる

#### ペルソナ2: マネージャー（佐藤さん）

- **年齢**: 42歳
- **役職**: 営業課長
- **課題**:
  - チームメンバー10人の日報確認が大変
  - 訪問実績の把握に時間がかかる
  - 紙ベースの承認業務が非効率
- **期待**:
  - 一覧でチームの活動が見える
  - ワンクリックで承認できる
  - 売上トレンドがグラフで見られる

---

## 🔧 3. 機能要件

### 3.1 訪問記録機能

#### 3.1.1 訪問記録の登録

**説明**: 営業担当者が店舗訪問の記録を入力する

**入力項目**:
- 訪問日時（必須）
- 店舗（必須、マスタから選択）
- 訪問目的（必須、選択式）
  - 定期訪問
  - 新規開拓
  - クレーム対応
  - 商品提案
  - その他
- 訪問時間（開始時刻・終了時刻）
- GPS位置情報（任意、自動取得）
- 商談内容（テキスト、最大1000文字）
- 提案商品（複数選択可）
- 競合情報（テキスト）
- 店舗状況（テキスト）
- 次回訪問予定日（任意）

**出力**:
- 訪問記録ID
- 登録完了メッセージ

**ビジネスルール**:
- 同じ店舗に同じ日時で複数の訪問記録は作成できない（警告表示）
- 未来の日付での訪問記録は登録できない

#### 3.1.2 訪問記録の一覧表示

**説明**: 登録済みの訪問記録を一覧表示する

**表示項目**:
- 訪問日時
- 店舗名
- 訪問目的
- 訪問時間
- ステータス

**機能**:
- 日付範囲での絞り込み
- 店舗名での検索
- 訪問目的での絞り込み
- 並び替え（日付昇順/降順）
- ページネーション（20件/ページ）

#### 3.1.3 訪問記録の編集・削除

**説明**: 登録済みの訪問記録を編集・削除する

**権限**:
- 作成者本人のみ編集可能
- 日報提出前のみ編集可能
- 管理者は全て編集可能

---

### 3.2 売上・受注記録機能

#### 3.2.1 受注の登録

**説明**: 訪問時の受注情報を記録する

**入力項目**:
- 受注日（必須）
- 店舗（必須、マスタから選択）
- 受注番号（自動生成）
- 商品明細（複数行）
  - 商品（マスタから選択）
  - 数量（整数）
  - 単価（自動取得、編集可）
  - 小計（自動計算）
- 割引額（任意）
- 合計金額（自動計算）
- 納品予定日（必須）
- 備考（テキスト）

**計算式**:
```
小計 = 単価 × 数量
合計金額 = Σ(小計) - 割引額
```

**出力**:
- 受注ID
- 受注番号
- 登録完了メッセージ

#### 3.2.2 受注の一覧表示

**表示項目**:
- 受注日
- 受注番号
- 店舗名
- 合計金額
- ステータス（未確定/確定/キャンセル）
- 納品予定日

**機能**:
- 日付範囲での絞り込み
- 店舗名での検索
- ステータスでの絞り込み
- 金額での並び替え

---

### 3.3 日報作成・提出機能

#### 3.3.1 日報の自動生成

**説明**: その日の訪問記録と受注情報から日報を自動生成する

**自動集約データ**:
- 訪問件数
- 訪問店舗リスト
- 受注件数
- 受注合計金額
- 訪問時間合計

**手動入力項目**:
- 本日の所感（テキスト、必須）
- 課題・問題点（テキスト、任意）
- 明日の予定（テキスト、任意）

#### 3.3.2 日報の提出・承認フロー

**フロー**:
1. **下書き保存**: 営業担当者が作成中の日報を保存
2. **提出**: 営業担当者が日報を提出（編集不可になる）
3. **承認/差し戻し**: マネージャーが確認し承認または差し戻し
4. **確定**: 承認後は確定状態となる

**ステータス**:
- DRAFT（下書き）
- SUBMITTED（提出済み）
- APPROVED（承認済み）
- REJECTED（差し戻し）

**通知**:
- 提出時: マネージャーに通知
- 承認時: 営業担当者に通知
- 差し戻し時: 営業担当者に通知（理由を含む）

---

### 3.4 マスタデータ管理機能

#### 3.4.1 店舗マスタ管理

**管理項目**:
- 店舗コード（一意、必須）
- 店舗名（必須）
- 店舗区分（スーパー/コンビニ/飲食店/その他）
- 郵便番号
- 住所（都道府県・市区町村・番地）
- 電話番号
- 担当者名
- メールアドレス
- 備考
- ステータス（有効/無効）

**機能**:
- 一覧表示（検索・並び替え）
- 新規登録
- 編集
- 無効化（削除は論理削除）

**権限**: ADMIN・MANAGERのみ

#### 3.4.2 商品マスタ管理

**管理項目**:
- 商品コード（一意、必須）
- 商品名（必須）
- カテゴリ（ビール/ハイボール/ウイスキー/ソフトドリンク/その他）
- 容量
- 標準価格（税込）
- JANコード
- 備考
- ステータス（有効/無効）

**機能**:
- 一覧表示（検索・並び替え）
- 新規登録
- 編集
- 無効化（削除は論理削除）

**権限**: ADMIN・MANAGERのみ

---

### 3.5 認証・権限管理機能

#### 3.5.1 ユーザー登録

**入力項目**:
- メールアドレス（必須、一意）
- パスワード（必須、8文字以上、英数字記号混在）
- 氏名（姓・名）
- 所属部署
- ロール（SALES/MANAGER/ADMIN）

**バリデーション**:
- メールアドレス形式チェック
- パスワード強度チェック
- 重複チェック

**権限**: ADMINのみ

#### 3.5.2 ログイン・ログアウト

**ログイン**:
- メールアドレス・パスワード認証
- JWT発行（有効期限24時間）
- セッション管理

**ログアウト**:
- セッション破棄
- トークン無効化

#### 3.5.3 パスワード変更

**機能**:
- 現在のパスワード確認
- 新しいパスワード設定
- 確認用パスワード入力

---

### 3.6 レポート・分析機能

#### 3.6.1 個人ダッシュボード（SALES）

**表示内容**:
- 今月の訪問件数（目標比）
- 今月の受注件数（目標比）
- 今月の売上合計（目標比）
- 今週の活動カレンダー
- 未提出の日報件数

#### 3.6.2 チームダッシュボード（MANAGER）

**表示内容**:
- チーム全体の訪問件数（今月）
- チーム全体の受注件数（今月）
- チーム全体の売上合計（今月）
- メンバー別実績ランキング
- 承認待ち日報件数

#### 3.6.3 レポート出力

**出力形式**:
- CSV形式
- PDF形式（予定）

**レポート種類**:
- 日次活動レポート
- 週次活動レポート
- 月次売上レポート

---

## 🔒 4. 非機能要件

### 4.1 パフォーマンス

| 項目 | 要件 |
|------|------|
| ページ読み込み時間 | 3秒以内（初回アクセス） |
| API応答時間 | 1秒以内（95パーセンタイル） |
| 同時接続ユーザー数 | 100ユーザー |
| データベースクエリ | 500ms以内 |

### 4.2 セキュリティ

- **認証**: JWT（JSON Web Token）
- **パスワード**: bcryptによるハッシュ化（salt rounds: 10）
- **通信**: HTTPS必須（本番環境）
- **CSRF対策**: NextAuth.js標準機能
- **XSS対策**: React自動エスケープ + CSPヘッダー
- **SQLインジェクション対策**: Prisma ORM（パラメータバインディング）
- **権限管理**: ロールベースアクセス制御（RBAC）

### 4.3 可用性

- **稼働率**: 99%以上（月間）
- **メンテナンス**: 週1回、深夜時間帯（2:00-4:00）
- **バックアップ**: 日次自動バックアップ（PostgreSQL）

### 4.4 スケーラビリティ

- **初期ユーザー数**: 50名
- **1年後想定**: 200名
- **データ増加率**: 月間10,000レコード
- **データ保持期間**: 3年間

### 4.5 ユーザビリティ

- **レスポンシブ対応**: デスクトップ・タブレット・スマートフォン
- **ブラウザ対応**:
  - Chrome（最新版）
  - Safari（最新版）
  - Edge（最新版）
  - Firefox（最新版）
- **アクセシビリティ**: WCAG 2.1 レベルA準拠（目標）

### 4.6 保守性

- **コード規約**: TypeScript strict mode、ESLint
- **テストカバレッジ**: 80%以上
- **ドキュメント**: コード内コメント、API仕様書、運用マニュアル

---

## 📊 5. データ要件

### 5.1 データ保持期間

| データ種別 | 保持期間 | 削除方法 |
|-----------|---------|---------|
| 訪問記録 | 3年 | 論理削除 |
| 受注データ | 3年 | 論理削除 |
| 日報 | 3年 | 論理削除 |
| ユーザー情報 | 退職後1年 | 論理削除 |
| マスタデータ | 無期限 | 論理削除 |

### 5.2 データバックアップ

- **頻度**: 日次（深夜2:00）
- **世代管理**: 7世代
- **保存先**: AWS S3（予定）
- **復旧目標**: RPO 24時間、RTO 4時間

---

## 🛠️ 6. 技術要件

### 6.1 技術スタック

| レイヤー | 技術 | バージョン |
|---------|------|-----------|
| フロントエンド | Next.js | 14.x |
| 言語 | TypeScript | 5.x |
| UIライブラリ | Tailwind CSS | 3.x |
| バックエンド | Next.js API Routes | 14.x |
| ORM | Prisma | 5.x |
| データベース | PostgreSQL | 15.x |
| 認証 | NextAuth.js | 4.x |
| デプロイ | Vercel（予定） | - |

### 6.2 開発環境

- **Node.js**: 20.x LTS
- **npm**: 10.x
- **Git**: 2.x
- **エディタ**: VS Code推奨

### 6.3 外部サービス

- **データベース**: Supabase / AWS RDS（検討中）
- **ファイルストレージ**: AWS S3 / Cloudinary（Phase 2）
- **メール送信**: SendGrid / AWS SES（Phase 2）

---

## 📅 7. 開発スケジュール

### Phase 1: MVP開発（3ヶ月）

| マイルストーン | 期間 | 成果物 |
|--------------|------|--------|
| 要件定義・設計 | 2週間 | 要件定義書、DB設計、画面設計 |
| 基本機能実装 | 6週間 | 認証、訪問記録、受注、日報 |
| テスト・修正 | 2週間 | テストコード、バグ修正 |
| リリース準備 | 2週間 | デプロイ、運用マニュアル |

### Phase 2: 機能拡張（2ヶ月）

- 写真添付機能
- 高度な分析機能
- CSV一括登録
- メール通知機能

### Phase 3: 最適化（1ヶ月）

- パフォーマンス改善
- UX改善
- モバイル最適化

---

## ✅ 8. 受入基準

### 8.1 機能受入基準

- [ ] 全ての必須機能が実装されている
- [ ] ユーザーロール別の権限制御が正しく動作する
- [ ] 日報の自動生成が正しく行われる
- [ ] 承認フローが正常に機能する
- [ ] マスタデータの登録・編集が可能

### 8.2 品質受入基準

- [ ] 全てのAPIエンドポイントが正常に動作する
- [ ] テストカバレッジが80%以上
- [ ] セキュリティスキャンで重大な脆弱性が0件
- [ ] ページ読み込み時間が3秒以内
- [ ] レスポンシブデザインが正しく機能する

### 8.3 ドキュメント受入基準

- [ ] API仕様書が完成している
- [ ] ユーザーマニュアルが完成している
- [ ] 運用マニュアルが完成している
- [ ] データベーススキーマ図が完成している

---

## 📝 9. リスク管理

### 9.1 識別されたリスク

| リスク | 影響度 | 発生確率 | 対策 |
|-------|--------|---------|------|
| データベース設計の変更 | 高 | 中 | 早期のプロトタイプ作成・レビュー |
| セキュリティ脆弱性 | 高 | 低 | 定期的なセキュリティスキャン |
| パフォーマンス問題 | 中 | 中 | 早期の負荷テスト実施 |
| 要件の追加・変更 | 中 | 高 | アジャイル開発、スプリント単位での調整 |

---

## 📞 10. ステークホルダー

| 役割 | 氏名/部署 | 責任範囲 |
|------|----------|---------|
| プロダクトオーナー | TBD | 要件定義、優先順位決定 |
| プロジェクトマネージャー | TBD | 進捗管理、リスク管理 |
| リードエンジニア | TBD | 技術選定、アーキテクチャ設計 |
| QAリード | TBD | テスト計画、品質保証 |

---

## 🔄 11. 変更履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|---------|--------|
| 1.0.0 | 2025-12-07 | 初版作成 | CodeGenAgent (源) |

---

**承認**:

- プロダクトオーナー: ______________ 日付: __________
- プロジェクトマネージャー: ______________ 日付: __________
- リードエンジニア: ______________ 日付: __________
